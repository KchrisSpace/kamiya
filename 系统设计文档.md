# Kamiya 花卉商城系统设计文档

## 一、逻辑结构设计

### 1.1 系统架构层次

```
┌─────────────────────────────────────────────────────────┐
│                    表现层 (Presentation Layer)            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │   前端用户界面  │  │   管理后台界面  │  │   移动端界面   │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│                   业务逻辑层 (Business Logic Layer)       │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │   用户管理模块  │  │   商品管理模块  │  │   订单管理模块  │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │   购物车模块   │  │   评论管理模块  │  │   反馈管理模块  │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│                   数据访问层 (Data Access Layer)          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │   Pinia Store │  │   Axios API   │  │   JSON Server │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│                   数据存储层 (Data Storage Layer)        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │    JSON数据库   │  │  LocalStorage │  │   文件存储     │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
```

### 1.2 功能模块划分

#### 1.2.1 用户端模块

| 模块名称         | 功能描述                             | 主要组件                                            | 数据流                                  |
| ---------------- | ------------------------------------ | --------------------------------------------------- | --------------------------------------- |
| **用户认证模块** | 用户注册、登录、登出                 | `login.vue`, `register.vue`                         | 用户输入 → 验证 → 存储 Token → 更新状态 |
| **商品展示模块** | 商品列表、详情、搜索、筛选           | `Store.vue`, `product-detail.vue`, `goods.vue`      | 获取商品数据 → 渲染展示 → 用户交互      |
| **购物车模块**   | 添加商品、修改数量、库存检查         | `cart.vue`, `cart.js`                               | 商品信息 → 购物车状态 → 持久化存储      |
| **订单模块**     | 订单创建、查看、状态管理、评价       | `order.vue`, `create-order.vue`, `order-review.vue` | 购物车数据 → 订单创建 → 状态流转 → 评价 |
| **个人中心模块** | 个人信息管理、头像昵称修改、我的评价 | `profile.vue`                                       | 用户信息 → 编辑 → 更新 → 展示           |
| **关于我们模块** | 品牌介绍、联系方式、反馈提交         | `about.vue`, `feedback.vue`                         | 静态内容展示 → 反馈提交 → 数据存储      |

#### 1.2.2 管理后台模块

| 模块名称         | 功能描述                               | 主要组件                          | 数据流                           |
| ---------------- | -------------------------------------- | --------------------------------- | -------------------------------- |
| **仪表盘模块**   | 数据概览、销售趋势、订单统计、库存预警 | `dashboard.vue`, 各统计组件       | 聚合数据 → 图表展示 → 实时更新   |
| **商品管理模块** | 商品增删改查、库存管理、折扣设置       | `products.vue`, `ProductForm.vue` | 商品数据 → CRUD 操作 → 数据同步  |
| **订单管理模块** | 订单查看、状态更新、详情管理           | `orders.vue`, `OrderDetail.vue`   | 订单列表 → 状态更新 → 通知用户   |
| **用户管理模块** | 用户信息查看、编辑、状态管理           | `users.vue`                       | 用户列表 → 信息编辑 → 权限管理   |
| **评论管理模块** | 评论查看、审核、回复、删除             | `comments.vue`                    | 评论数据 → 审核操作 → 可见性控制 |
| **反馈管理模块** | 反馈查看、处理状态管理、删除           | `feedback.vue`                    | 反馈数据 → 状态标记 → 处理跟踪   |
| **系统设置模块** | 店铺信息、业务设置、通知设置           | `settings.vue`                    | 配置数据 → 保存 → 全局生效       |

### 1.3 数据流设计

#### 1.3.1 用户登录流程

```
用户输入账号密码
    ↓
前端验证格式
    ↓
发送登录请求 (POST /users)
    ↓
后端验证用户信息
    ↓
生成Token并返回
    ↓
前端存储Token到localStorage
    ↓
更新Pinia用户状态
    ↓
路由跳转到首页/管理后台
```

#### 1.3.2 商品购买流程

```
浏览商品列表
    ↓
查看商品详情
    ↓
检查库存状态
    ↓
添加到购物车
    ↓
修改购物车商品数量
    ↓
创建订单
    ↓
订单状态流转（待确认 → 进行中 → 预备出餐 → 已出餐 → 已完成）
    ↓
用户确认取餐
    ↓
订单评价
```

#### 1.3.3 订单状态流转

```
待商家确认
    ↓
进行中
    ↓
预备出餐中
    ↓
已出餐（用户端显示：可取餐）
    ↓
已完成（可评价）
    ↓
已取消（任意状态可取消）
```

### 1.4 状态管理设计

#### 1.4.1 Pinia Store 结构

| Store 名称           | 状态数据                                           | 主要方法                                                       | 用途                   |
| -------------------- | -------------------------------------------------- | -------------------------------------------------------------- | ---------------------- |
| **user.js**          | `userInfo`, `token`, `userId`, `isAdmin`           | `login()`, `logout()`, `getUserInfo()`, `updateUserInfo()`     | 用户认证和用户信息管理 |
| **cart.js**          | `cartItems`, `itemTotals`, `isLoading`             | `addItem()`, `removeItem()`, `updateCartItem()`, `clearCart()` | 购物车状态管理         |
| **products.js**      | `products`, `currentPage`, `totalPages`, `loading` | `fetchProducts()`, `fetchProductById()`, `addProduct()`        | 商品数据管理           |
| **normal-orders.js** | `orders`, `currentOrder`, `loading`                | `createOrder()`, `fetchOrders()`, `updateOrderStatus()`        | 订单数据管理           |

#### 1.4.2 数据持久化策略

- **用户登录状态**: 存储在 `localStorage`，键名分别为 `userToken`/`adminToken`、`userId`/`adminUserId`
- **购物车数据**: 存储在 `localStorage`，键名为 `cartItems`
- **业务数据**: 存储在 `db.json`，通过 JSON Server 提供 RESTful API

### 1.5 路由设计

#### 1.5.1 前端路由结构

```
/ (Layout)
├── / (首页)
├── /store (商店)
├── /product/:id (商品详情)
├── /cart (购物车)
├── /order (订单列表)
├── /create-order (创建订单)
├── /order-review/:orderId (订单评价)
├── /profile (个人中心)
├── /about (关于我们)
├── /customize (定制页面)
├── /login (登录)
└── /register (注册)
```

#### 1.5.2 管理后台路由结构

```
/admin (AdminLayout)
├── /admin/dashboard (仪表盘)
├── /admin/products (商品管理)
├── /admin/orders (订单管理)
├── /admin/users (用户管理)
├── /admin/comments (评论管理)
├── /admin/feedback (反馈管理)
└── /admin/settings (系统设置)
```

### 1.6 权限控制设计

| 角色           | 前端访问权限       | 后台访问权限 | 特殊功能           |
| -------------- | ------------------ | ------------ | ------------------ |
| **未登录用户** | 浏览商品、查看详情 | 无           | 无                 |
| **普通用户**   | 全部前端功能       | 无           | 购物、下单、评价   |
| **管理员**     | 无（自动跳转后台） | 全部后台功能 | 数据管理、系统配置 |

---

## 二、数据库表设计

### 2.1 用户表 (users)

| 字段名             | 数据类型 | 长度 | 约束                     | 说明                               |
| ------------------ | -------- | ---- | ------------------------ | ---------------------------------- |
| **id**             | String   | 50   | PRIMARY KEY, NOT NULL    | 用户唯一标识（如：user1, admin）   |
| **username**       | String   | 50   | UNIQUE, NOT NULL         | 登录用户名                         |
| **password**       | String   | 255  | NOT NULL                 | 密码（明文存储，实际项目应加密）   |
| **role**           | String   | 20   | NOT NULL, DEFAULT 'user' | 用户角色（admin/user）             |
| **email**          | String   | 100  |                          | 邮箱地址                           |
| **phone**          | String   | 20   |                          | 手机号码                           |
| **email_verified** | Boolean  |      | DEFAULT false            | 邮箱验证状态                       |
| **phone_verified** | Boolean  |      | DEFAULT false            | 手机验证状态                       |
| **account_status** | String   | 20   | DEFAULT 'active'         | 账户状态（active/inactive/banned） |
| **user_info**      | Object   |      |                          | 用户扩展信息对象                   |
| └─ **nickname**    | String   | 50   |                          | 用户昵称                           |
| └─ **avatar**      | String   | 500  |                          | 头像 URL 路径                      |
| **created_at**     | String   |      | NOT NULL                 | 创建时间（ISO 8601 格式）          |
| **updated_at**     | String   |      | NOT NULL                 | 更新时间（ISO 8601 格式）          |

**索引设计:**

- PRIMARY KEY: `id`
- UNIQUE INDEX: `username`
- INDEX: `role`, `account_status`

**示例数据:**

```json
{
  "id": "user1",
  "username": "user1",
  "password": "000000",
  "role": "user",
  "email": "user1@example.com",
  "phone": "13800000001",
  "email_verified": false,
  "phone_verified": false,
  "account_status": "active",
  "user_info": {
    "nickname": "小美",
    "avatar": ""
  },
  "created_at": "2025-12-28T09:41:57.374Z",
  "updated_at": "2025-12-28T10:58:40.305Z"
}
```

### 2.2 商品表 (products_list)

| 字段名                | 数据类型      | 长度 | 约束                  | 说明                            |
| --------------------- | ------------- | ---- | --------------------- | ------------------------------- |
| **id**                | String        | 50   | PRIMARY KEY, NOT NULL | 商品唯一标识（如：P01, P02）    |
| **title**             | String        | 200  | NOT NULL              | 商品名称                        |
| **main_category**     | String        | 50   |                       | 主分类（热销/上新/特价出售）    |
| **category**          | String        | 50   |                       | 商品类别（单品/冷品/暖品/套餐） |
| **price_info**        | Object        |      | NOT NULL              | 价格信息对象                    |
| └─ **original_price** | Number        |      | NOT NULL              | 原价                            |
| └─ **current_price**  | Number/String |      | NOT NULL              | 当前价格                        |
| └─ **hasDiscount**    | Boolean       |      | DEFAULT false         | 是否有折扣                      |
| └─ **discount**       | Number        |      | DEFAULT 0             | 折扣百分比（0-100）             |
| **stock**             | Number        |      | NOT NULL, DEFAULT 0   | 库存数量                        |
| **description**       | String        | 2000 |                       | 商品描述（可选）                |
| **images**            | String        | 500  |                       | 商品主图 URL                    |
| **promotion**         | Object        |      |                       | 促销信息对象                    |
| └─ **keywords**       | Array         |      |                       | 关键词数组                      |
| └─ **material**       | String        | 500  |                       | 材料说明                        |
| └─ **is_hot**         | Boolean       |      | DEFAULT false         | 是否热门                        |
| **sales**             | Number        |      | DEFAULT 0             | 销量                            |
| **score**             | Number        |      | DEFAULT 0             | 评分                            |
| **status**            | String        | 10   | NOT NULL, DEFAULT '1' | 商品状态（1:上架, 0:下架）      |
| **views**             | Number        |      | DEFAULT 0             | 浏览量                          |
| **favorites**         | Number        |      | DEFAULT 0             | 收藏数                          |
| **created_at**        | String        |      |                       | 创建时间（ISO 8601 格式）       |
| **updated_at**        | String        |      |                       | 更新时间（ISO 8601 格式）       |

**索引设计:**

- PRIMARY KEY: `id`
- INDEX: `main_category`, `category`, `status`, `stock`

**示例数据:**

```json
{
  "id": "P01",
  "title": "星与你皆浪漫",
  "main_category": "热销",
  "category": "单品",
  "price_info": {
    "current_price": "359.10",
    "original_price": 399,
    "hasDiscount": true,
    "discount": 10
  },
  "stock": 9,
  "description": "feivhangthdd",
  "images": "https://photo.yannick.com.tw/photo/0201039/...",
  "promotion": {
    "keywords": ["星空", "浪漫", "情人节", "告白"],
    "material": "安佳动物奶油，比利时巧克力，食用金箔，星空糖珠"
  },
  "sales": 0,
  "status": "1",
  "hasDiscount": true,
  "discount": 10
}
```

### 2.3 商品评论表 (product_comments)

| 字段名           | 数据类型 | 长度 | 约束                  | 说明                           |
| ---------------- | -------- | ---- | --------------------- | ------------------------------ |
| **id**           | String   | 50   | PRIMARY KEY, NOT NULL | 评论唯一标识（如：C001, C002） |
| **product_id**   | String   | 50   | NOT NULL, FOREIGN KEY | 商品 ID，关联 products_list.id |
| **user_id**      | String   | 50   | NOT NULL, FOREIGN KEY | 用户 ID，关联 users.id         |
| **user_name**    | String   | 100  |                       | 用户昵称（快照）               |
| **avatar**       | String   | 500  |                       | 用户头像 URL（快照）           |
| **content**      | String   | 2000 |                       | 评论内容                       |
| **rating**       | Number   |      | NOT NULL, CHECK(1-5)  | 评分（1-5 星）                 |
| **tags**         | Array    |      |                       | 评价标签数组                   |
| **images**       | Array    |      |                       | 评价图片 URL 数组              |
| **useful_count** | Number   |      | DEFAULT 0             | 有用数                         |
| **is_visible**   | Boolean  |      | DEFAULT true          | 是否可见                       |
| **is_audited**   | Boolean  |      | DEFAULT false         | 是否已审核                     |
| **reply**        | String   | 1000 |                       | 商家回复内容                   |
| **reply_time**   | String   |      |                       | 商家回复时间（ISO 8601 格式）  |
| **created_at**   | String   |      | NOT NULL              | 创建时间（ISO 8601 格式）      |
| **updated_at**   | String   |      | NOT NULL              | 更新时间（ISO 8601 格式）      |

**索引设计:**

- PRIMARY KEY: `id`
- INDEX: `product_id`, `user_id`, `is_visible`, `created_at`

**示例数据:**

```json
{
  "id": "C001",
  "product_id": "P01",
  "user_id": "user1",
  "user_name": "小美",
  "avatar": "/images/users/avater/user1.png",
  "content": "味道很好，推荐购买！",
  "rating": 5,
  "tags": ["味道鲜美", "包装精美"],
  "images": [],
  "useful_count": 3,
  "is_visible": true,
  "is_audited": true,
  "reply": "感谢您的支持！",
  "reply_time": "2025-12-28T10:50:26.802Z",
  "created_at": "2025-12-28T10:50:26.802Z",
  "updated_at": "2025-12-28T10:50:26.802Z"
}
```

### 2.4 订单表 (normal_orders)

| 字段名              | 数据类型 | 长度 | 约束                        | 说明                                                          |
| ------------------- | -------- | ---- | --------------------------- | ------------------------------------------------------------- |
| **id**              | Number   |      | PRIMARY KEY, AUTO_INCREMENT | 订单唯一标识                                                  |
| **user_id**         | String   | 50   | NOT NULL, FOREIGN KEY       | 用户 ID，关联 users.id                                        |
| **items**           | Array    |      | NOT NULL                    | 订单商品项数组                                                |
| └─ **product_id**   | String   | 50   | NOT NULL                    | 商品 ID                                                       |
| └─ **product_name** | String   | 200  | NOT NULL                    | 商品名称（快照）                                              |
| └─ **quantity**     | Number   |      | NOT NULL                    | 购买数量                                                      |
| └─ **single_price** | Number   |      | NOT NULL                    | 单价（快照）                                                  |
| **total_price**     | Number   |      | NOT NULL                    | 订单总价                                                      |
| **shipping_fee**    | Number   |      | DEFAULT 0                   | 配送费用                                                      |
| **delivery_time**   | String   |      |                             | 取餐时间                                                      |
| **consignee**       | String   | 100  |                             | 收货人姓名                                                    |
| **phone**           | String   | 20   |                             | 联系电话                                                      |
| **remark**          | String   | 500  |                             | 订单备注                                                      |
| **status**          | String   | 50   | NOT NULL                    | 订单状态（待商家确认/进行中/预备出餐中/已出餐/已完成/已取消） |
| **payment_method**  | String   | 50   |                             | 支付方式（wechat/alipay/cash）                                |
| **payment_time**    | String   |      |                             | 支付时间（ISO 8601 格式）                                     |
| **shipped_time**    | String   |      |                             | 出餐时间（ISO 8601 格式）                                     |
| **completed_time**  | String   |      |                             | 完成时间（ISO 8601 格式）                                     |
| **communications**  | Array    |      |                             | 订单沟通记录数组                                              |
| └─ **role**         | String   | 20   |                             | 角色（customer/admin）                                        |
| └─ **text**         | String   | 1000 |                             | 消息内容                                                      |
| └─ **images**       | Array    |      |                             | 消息图片数组                                                  |
| └─ **created_at**   | String   |      |                             | 消息时间（ISO 8601 格式）                                     |
| **created_at**      | String   |      | NOT NULL                    | 创建时间（ISO 8601 格式）                                     |
| **updated_at**      | String   |      | NOT NULL                    | 更新时间（ISO 8601 格式）                                     |

**索引设计:**

- PRIMARY KEY: `id`
- INDEX: `user_id`, `status`, `created_at`

**示例数据:**

```json
{
  "id": 3,
  "user_id": "user1",
  "items": [
    {
      "product_id": "P01",
      "product_name": "星与你皆浪漫",
      "quantity": 1,
      "single_price": 559.9
    }
  ],
  "total_price": 559.9,
  "shipping_fee": 0,
  "delivery_time": "2025-12-29Tmorning:00Z",
  "consignee": "1111",
  "phone": "11111111111",
  "remark": "ok",
  "status": "已完成",
  "payment_method": "wechat",
  "payment_time": null,
  "shipped_time": "2025-12-28T11:30:18.403Z",
  "completed_time": "2025-12-28T11:34:50.197Z",
  "created_at": "2025-12-28T11:29:54.584Z",
  "updated_at": "2025-12-28T11:34:50.197Z"
}
```

### 2.5 购物车表 (cart)

| 字段名         | 数据类型 | 长度 | 约束                  | 说明                           |
| -------------- | -------- | ---- | --------------------- | ------------------------------ |
| **id**         | String   | 100  | PRIMARY KEY, NOT NULL | 购物车项唯一标识               |
| **user_id**    | String   | 50   | NOT NULL, FOREIGN KEY | 用户 ID，关联 users.id         |
| **product_id** | String   | 50   | NOT NULL, FOREIGN KEY | 商品 ID，关联 products_list.id |
| **quantity**   | Number   |      | NOT NULL, DEFAULT 1   | 商品数量                       |
| **created_at** | String   |      | NOT NULL              | 创建时间（ISO 8601 格式）      |

**索引设计:**

- PRIMARY KEY: `id`
- INDEX: `user_id`, `product_id`
- UNIQUE INDEX: `(user_id, product_id)` - 同一用户同一商品只能有一条记录

**示例数据:**

```json
{
  "id": "cart_1703840123456_abc123",
  "user_id": "user1",
  "product_id": "P01",
  "quantity": 2,
  "created_at": "2025-12-28T10:00:00.000Z"
}
```

### 2.6 轮播图表 (carousel)

| 字段名  | 数据类型 | 长度 | 约束                  | 说明            |
| ------- | -------- | ---- | --------------------- | --------------- |
| **id**  | String   | 50   | PRIMARY KEY, NOT NULL | 轮播图唯一标识  |
| **img** | String   | 500  | NOT NULL              | 轮播图 URL 路径 |

**索引设计:**

- PRIMARY KEY: `id`

**示例数据:**

```json
{
  "id": "1",
  "img": "/images/carousel-img/carousel-1.png"
}
```

### 2.7 定制表 (custom)

| 字段名             | 数据类型 | 长度 | 约束                  | 说明                      |
| ------------------ | -------- | ---- | --------------------- | ------------------------- |
| **id**             | String   | 50   | PRIMARY KEY, NOT NULL | 定制订单唯一标识          |
| **user_id**        | String   | 50   | NOT NULL, FOREIGN KEY | 用户 ID，关联 users.id    |
| **custom_img**     | String   | 500  |                       | 定制图片 URL              |
| **email**          | String   | 100  |                       | 联系邮箱                  |
| **phone**          | String   | 20   |                       | 联系电话                  |
| **custom_message** | String   | 1000 |                       | 定制需求描述              |
| **created_at**     | String   |      | NOT NULL              | 创建时间（ISO 8601 格式） |
| **updated_at**     | String   |      | NOT NULL              | 更新时间（ISO 8601 格式） |

**索引设计:**

- PRIMARY KEY: `id`
- INDEX: `user_id`, `created_at`

**示例数据:**

```json
{
  "id": "1",
  "user_id": "user2",
  "custom_img": "",
  "email": "123456@qq.com",
  "phone": "12345678901",
  "custom_message": "贺卡写上生日快乐",
  "created_at": "2025-04-25T17:51:56.908Z",
  "updated_at": "2025-04-25T17:51:56.908Z"
}
```

### 2.8 反馈表 (feedback)

| 字段名               | 数据类型 | 长度 | 约束                  | 说明                                           |
| -------------------- | -------- | ---- | --------------------- | ---------------------------------------------- |
| **id**               | String   | 50   | PRIMARY KEY, NOT NULL | 反馈唯一标识                                   |
| **user_id**          | String   | 50   | FOREIGN KEY           | 用户 ID，关联 users.id（可为空，支持匿名反馈） |
| **name**             | String   | 100  | NOT NULL              | 反馈人姓名                                     |
| **email**            | String   | 100  | NOT NULL              | 反馈人邮箱                                     |
| **phone**            | String   | 20   | NOT NULL              | 反馈人电话                                     |
| **feedback_message** | String   | 2000 | NOT NULL              | 反馈内容                                       |
| **status**           | String   | 20   | DEFAULT 'pending'     | 处理状态（pending/processed）                  |
| **created_at**       | String   |      | NOT NULL              | 创建时间（ISO 8601 格式）                      |
| **updated_at**       | String   |      | NOT NULL              | 更新时间（ISO 8601 格式）                      |

**索引设计:**

- PRIMARY KEY: `id`
- INDEX: `user_id`, `status`, `created_at`

**示例数据:**

```json
{
  "id": "1",
  "user_id": "user2",
  "name": "刘盈盈",
  "email": "123456@qq.com",
  "phone": "12345678901",
  "feedback_message": "花布很好看，我很喜欢",
  "status": "pending",
  "created_at": "2025-04-25T17:51:56.908Z",
  "updated_at": "2025-04-25T17:51:56.908Z"
}
```

### 2.9 表关系图

```
users (用户表)
  ├── 1:N → normal_orders (订单表) [user_id]
  ├── 1:N → product_comments (商品评论表) [user_id]
  ├── 1:N → cart (购物车表) [user_id]
  ├── 1:N → custom (定制表) [user_id]
  └── 1:N → feedback (反馈表) [user_id]

products_list (商品表)
  ├── 1:N → product_comments (商品评论表) [product_id]
  ├── 1:N → cart (购物车表) [product_id]
  └── 1:N → normal_orders.items (订单商品项) [product_id]

normal_orders (订单表)
  └── N:1 → users (用户表) [user_id]

product_comments (商品评论表)
  ├── N:1 → products_list (商品表) [product_id]
  └── N:1 → users (用户表) [user_id]
```

### 2.10 数据完整性约束

#### 2.10.1 外键约束

- `product_comments.product_id` → `products_list.id` (ON DELETE CASCADE)
- `product_comments.user_id` → `users.id` (ON DELETE SET NULL)
- `normal_orders.user_id` → `users.id` (ON DELETE RESTRICT)
- `cart.user_id` → `users.id` (ON DELETE CASCADE)
- `cart.product_id` → `products_list.id` (ON DELETE CASCADE)
- `custom.user_id` → `users.id` (ON DELETE CASCADE)
- `feedback.user_id` → `users.id` (ON DELETE SET NULL)

#### 2.10.2 业务规则约束

1. **库存约束**: 商品库存不能为负数，添加购物车和下单时需检查库存
2. **订单状态约束**: 订单状态必须按照预设流程流转，不能跳跃
3. **评论约束**: 只有已完成订单的商品才能进行评价
4. **价格约束**: 当前价格不能高于原价（除非有特殊业务逻辑）
5. **用户角色约束**: 管理员账号不能在前端登录，只能访问后台

---

## 三、设计说明

### 3.1 设计原则

1. **数据快照原则**: 订单中的商品信息（名称、价格）采用快照方式存储，确保历史订单数据不受商品信息变更影响
2. **软删除原则**: 评论、反馈等数据采用 `is_visible` 字段控制可见性，而非物理删除
3. **时间戳原则**: 所有表都包含 `created_at` 和 `updated_at` 字段，便于数据追踪和审计
4. **角色分离原则**: 管理员和普通用户使用不同的登录状态存储，支持同时登录

### 3.2 性能优化建议

1. **索引优化**: 在频繁查询的字段上建立索引（如 `user_id`, `product_id`, `status`）
2. **分页查询**: 商品列表、订单列表等大数据量场景使用分页查询
3. **数据缓存**: 使用 Pinia Store 和 localStorage 缓存常用数据，减少 API 请求
4. **图片优化**: 商品图片使用 CDN 或压缩处理，提升加载速度

### 3.3 扩展性考虑

1. **字段扩展**: 各表预留了扩展字段（如 `user_info` 对象），便于后续功能扩展
2. **状态枚举**: 订单状态、用户状态等使用字符串类型，便于扩展新的状态值
3. **模块化设计**: 采用模块化架构，便于新增功能模块

---

**文档版本**: v1.0  
**最后更新**: 2025-12-28  
**维护人员**: 开发团队
